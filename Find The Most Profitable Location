POSTGRE SQL:

WITH signups_table AS
(
SELECT location, AVG(signup_stop_date - signup_start_date) AS mean_duration
FROM signups 
GROUP BY 1
), 

transactions_table AS
(
SELECT location, AVG(amt) AS mean_revenue
FROM signups s
JOIN transactions t 
ON s.signup_id = t.signup_id
GROUP BY 1
)

SELECT st.location, st.mean_duration, tt.mean_revenue, tt.mean_revenue/st.mean_duration
FROM transactions_table tt 
JOIN signups_table st 
ON tt.location = st.location
ORDER BY 4 DESC


PYTHON:


R:
